<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Rails 3.0 rescue from Routing Error Solution</title>
	<meta name="description" content="Software Engineer. JavaScript. Ruby. Rails.">
	<meta name="author" content="Tian Davis">
	
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/stylesheets/base.css">
	<link rel="stylesheet" href="/stylesheets/skeleton.css">
	<link rel="stylesheet" href="/stylesheets/layout.css">
	<link rel="stylesheet" href="/stylesheets/docs.css">
	<link rel="stylesheet" href="/stylesheets/syntax.css">

	<!-- Favicon
	================================================== -->
	<link rel="shortcut icon" href="/images/favicon.ico">
	<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

</head>
<body data-twttr-rendered="true">
			<div class="container">
				<div class="three columns sidebar">
					<nav>
						<h3 id="logo">Spartan</h3>
						
						<ul>
							<li class="icon blog"><a href="/">Blog</a></li>
							<li class="icon email"><a href="mailto:hello@tiandavis.com">Email</a></li>
							<li class="icon twitter"><a href="https://twitter.com/tiandavis">Twitter</a></li>
							<li class="icon github"><a href="https://github.com/tiandavis">Github</a></li>
						</ul>
					</nav>
					&nbsp;
				</div>
				
				<div class="twelve columns offset-by-one content">
					<div class="doc-section clearfix post" id="typography">
	<h2>Rails 3.0 rescue from Routing Error Solution</h2>
	
	<p>Well, I&#39;ve got good news and I&#39;ve got bad news. As of Rails 3.0.1, using rescue_from in your ApplicationController to recover from a routing error is broken! That&#39;s the bad news.</p>

<p>The good news is I have a solution that will keep you in unison with the Rails Core Team. The Rails team has promised a fix some time in Rails 3.1. Until then, I&#39;ve got readers and I&#39;ve got customers and I <em>shudder</em> at the thought of showing them a generic error page.</p>

<h3>The Situation</h3>

<p>It&#39;s bad enough an error has occurred in the first place. At that point I want to take control of the situation and rescue my audience from a bad experience back to enjoyment!</p>

<p>Previously in Rails 2.3.8 and below you could handle routing errors elegantly using rescue_from ActionController::RoutingError:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
      <span class="n">rescue_from</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">RoutingError</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:render_404</span>
    
      <span class="kp">private</span>
      <span class="k">def</span> <span class="nf">render_404</span><span class="p">(</span><span class="n">exception</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exception</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Rendering 404: </span><span class="si">#{</span><span class="n">exception</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">end</span>
          
        <span class="n">render</span> <span class="ss">:file</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/public/404.html&quot;</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="mi">404</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>

<p>However, things are a little different in Rails 3. The reality is, as of Rails 3.0.1, ApplicationController can&#39;t catch ActionController::RoutingError and thus, we cannot take advantage of rescue_from like we used to.</p>

<p>Now, for those of you who don&#39;t know, I&#39;m a realist. So, I&#39;m not expecting the Rails team to spring a solution overnight.</p>

<p>Personally, I&#39;m going to wait for the Official fix from the Rails Core Team. In the meantime, I need a simple, no side effects solution that I can use right now!</p>

<h3>Simple Solution</h3>

<p>This is one of those times when it&#39;s great to be a developer. There is nothing we can&#39;t solve with a little elbow grease and ingenuity. </p>

<p>Expanding on the suggestion given by the Rails core team, here&#39;s the solution I use to handle routing errors in Rails 3.0:</p>

<h4>config/routes.rb</h4>

<p>This code should go to the end of your routes.rb file. That way it will be given the least priority and therefore, act as a wildcard catchall for all those rogue url resources.</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">Yourapp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
      <span class="c1">#Last route in routes.rb</span>
      <span class="n">match</span> <span class="s1">&#39;*a&#39;</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">&#39;errors#routing&#39;</span>
    <span class="k">end</span>
</code></pre></div>

<p>NOTE: The &quot;a&quot; is actually a parameter in the Rails 3 Route Globbing technique. For example, if your url was <em>/this-url-does-not-exist</em>, then params[:a] equals &quot;<em>/this-url-does-not-exist</em>&quot;. So be as creative as you&#39;d like handling that rogue route.</p>

<h4>app/controllers/errors_controller.rb</h4>

<p>Here, I handle my routing errors. I leverage previous 404 handling code from my original ApplicationController mentioned above. So, my errors_controller.rb looks like this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">ErrorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
      <span class="k">def</span> <span class="nf">routing</span>
        <span class="n">render_404</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>

<p>However, feel free to modify to fit your individual needs. Everyone&#39;s situation will be slightly different. For example, if you&#39;re not going to reuse your 404 error handling logic, then here&#39;s the full ErrorsController without inheritance:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">ErrorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
      <span class="k">def</span> <span class="nf">routing</span>
       <span class="n">render</span> <span class="ss">:file</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/public/404.html&quot;</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="mi">404</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>

<p>I&#39;m big on keeping things simple. I believe solutions should be simple without being simplistic. Like I said earlier, I look forward to an Official solution from the Rails Core Team. Until then, this gets the job done!</p>

<p>Well, I encourage you to dig into Rails 3 and have a little fun. And if you have another solution, post here so we can discuss. Until next time Beloved, take care!</p>

</div>
				</div>
					
			</div><!-- container -->

			<div class="resize"></div>
	
</body></html>